{
	"name": "23-Product Portfolio Performance with Running Totals",
	"properties": {
		"content": {
			"query": "-- 9. Product Performance with Running Totals and Cumulative Revenue\nWITH ProductSales AS (\n    SELECT \n        p.ProductID,\n        p.ProductName,\n        p.Brand,\n        CAST(s.TransactionDate AS DATE) AS SalesDate,\n        SUM(s.Quantity) AS DailyQuantity,\n        SUM(s.Quantity * s.UnitPrice - ISNULL(s.Discount, 0)) AS DailyRevenue\n    FROM OPENROWSET(\n        BULK 'https://adls4salesdata.blob.core.windows.net/transformed-data/products.parquet/*.parquet',\n        FORMAT = 'PARQUET'\n    ) AS p\n    JOIN OPENROWSET(\n        BULK 'https://adls4salesdata.blob.core.windows.net/transformed-data/sales_clean.parquet/*.parquet',\n        FORMAT = 'PARQUET'\n    ) AS s ON p.ProductID = s.ProductID\n    GROUP BY p.ProductID, p.ProductName, p.Brand, CAST(s.TransactionDate AS DATE)\n)\nSELECT \n    ProductID,\n    ProductName,\n    Brand,\n    SalesDate,\n    DailyQuantity,\n    DailyRevenue,\n    SUM(DailyRevenue) OVER (\n        PARTITION BY ProductID \n        ORDER BY SalesDate \n        ROWS UNBOUNDED PRECEDING\n    ) AS CumulativeRevenue,\n    AVG(DailyRevenue) OVER (\n        PARTITION BY ProductID \n        ORDER BY SalesDate \n        ROWS BETWEEN 6 PRECEDING AND CURRENT ROW\n    ) AS WeeklyMovingAvg,\n    RANK() OVER (PARTITION BY SalesDate ORDER BY DailyRevenue DESC) AS DailyRank,\n    PERCENT_RANK() OVER (PARTITION BY SalesDate ORDER BY DailyRevenue) AS DailyPercentile\nFROM ProductSales\nORDER BY ProductID, SalesDate;",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "master",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}